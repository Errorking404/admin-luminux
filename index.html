<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”¥ LUMINUX ADMIN PANEL</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            color: white; min-height: 100vh; 
        }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        .header { 
            text-align: center; margin-bottom: 40px; 
            background: rgba(255,255,255,0.1); padding: 30px; border-radius: 20px; 
            backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2);
        }
        .header h1 { font-size: 2.5em; background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 40px; }
        .stat-card { 
            background: rgba(255,255,255,0.1); padding: 25px; border-radius: 15px; 
            backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2);
            text-align: center; transition: transform 0.3s;
        }
        .stat-card:hover { transform: translateY(-5px); }
        .stat-number { font-size: 2.5em; font-weight: bold; background: linear-gradient(45deg, #4ecdc4, #45b7d1); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .nav-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .nav-btn { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            border: none; padding: 20px 30px; border-radius: 15px; 
            color: white; font-size: 1.2em; font-weight: bold; cursor: pointer; 
            transition: all 0.3s; position: relative; overflow: hidden;
        }
        .nav-btn:hover { transform: translateY(-3px); box-shadow: 0 20px 40px rgba(0,0,0,0.3); }
        .nav-btn:active { transform: translateY(-1px); }
        .section { display: none; background: rgba(255,255,255,0.05); padding: 30px; border-radius: 20px; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); }
        .section.active { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: bold; color: #4ecdc4; }
        .form-group input, .form-group select { width: 100%; padding: 15px; border: 2px solid rgba(255,255,255,0.2); border-radius: 10px; background: rgba(255,255,255,0.1); color: white; font-size: 1em; }
        .form-group input::placeholder { color: rgba(255,255,255,0.7); }
        .btn { background: linear-gradient(135deg, #ff6b6b, #ff8e8e); border: none; padding: 12px 30px; border-radius: 10px; color: white; font-weight: bold; cursor: pointer; transition: all 0.3s; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(0,0,0,0.3); }
        .btn.danger { background: linear-gradient(135deg, #ff4757, #ff3838); }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; background: rgba(255,255,255,0.1); border-radius: 15px; overflow: hidden; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.1); }
        th { background: rgba(255,255,255,0.2); font-weight: bold; }
        tr:hover { background: rgba(255,255,255,0.1); }
        .loading { text-align: center; padding: 40px; font-size: 1.2em; }
        .error { color: #ff4757; background: rgba(255,71,87,0.2); padding: 15px; border-radius: 10px; margin: 10px 0; }
        .success { color: #2ed573; background: rgba(46,213,115,0.2); padding: 15px; border-radius: 10px; margin: 10px 0; }
        @media (max-width: 768px) { .container { padding: 10px; } .nav-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”¥ LUMINUX ADMIN PANEL</h1>
            <p>Full database control using ANON key only (RLS-safe queries)</p>
        </div>

        <!-- STATS -->
        <div id="statsSection" class="stats-grid section active">
            <div class="stat-card">
                <div class="stat-number" id="toolsCount">-</div>
                <div>ğŸ› ï¸ Tools</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="usersCount">-</div>
                <div>ğŸ‘¥ Users</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="purchasesCount">-</div>
                <div>ğŸ›’ Purchases</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="topTools">-</div>
                <div>ğŸ”¥ Top Tool Likes</div>
            </div>
        </div>

        <!-- NAV BUTTONS -->
        <div class="nav-grid">
            <button class="nav-btn" onclick="showSection('tools')">ğŸ› ï¸ View All Tools</button>
            <button class="nav-btn" onclick="showSection('users')">ğŸ‘¥ View All Users</button>
            <button class="nav-btn" onclick="showSection('purchases')">ğŸ›’ All Purchases</button>
            <button class="nav-btn" onclick="showSection('addCoins')">ğŸ’° Add Coins</button>
            <button class="nav-btn" onclick="showSection('createUser')">ğŸ†• Create User</button>
            <button class="nav-btn" onclick="showSection('createTool')">ğŸ†• Create Tool</button>
            <button class="nav-btn danger" onclick="showSection('delete')">ğŸ—‘ï¸ Delete Record</button>
            <button class="nav-btn" onclick="showSection('dump')">ğŸ’¾ Dump All Data</button>
        </div>

        <!-- TOOLS SECTION -->
        <div id="toolsSection" class="section">
            <h2>ğŸ› ï¸ All Tools (loadTools() clone)</h2>
            <div id="toolsTable"></div>
        </div>

        <!-- USERS SECTION -->
        <div id="usersSection" class="section">
            <h2>ğŸ‘¥ All Users (sorted by coins)</h2>
            <div id="usersTable"></div>
        </div>

        <!-- PURCHASES SECTION -->
        <div id="purchasesSection" class="section">
            <h2>ğŸ›’ All Purchases</h2>
            <div id="purchasesTable"></div>
        </div>

        <!-- ADD COINS FORM -->
        <div id="addCoinsSection" class="section">
            <h2>ğŸ’° Add Coins to User</h2>
            <div class="form-group">
                <label>Username:</label>
                <input type="text" id="coinUsername" placeholder="Enter username">
            </div>
            <div class="form-group">
                <label>Amount (+/-):</label>
                <input type="number" id="coinAmount" placeholder="100">
            </div>
            <button class="btn" onclick="addCoins()">â• Add Coins</button>
            <div id="coinResult"></div>
        </div>

        <!-- CREATE USER FORM -->
        <div id="createUserSection" class="section">
            <h2>ğŸ†• Create New User</h2>
            <div class="form-group">
                <label>Email:</label>
                <input type="email" id="newUserEmail" placeholder="user@example.com">
            </div>
            <div class="form-group">
                <label>Username:</label>
                <input type="text" id="newUserName" placeholder="hackerone">
            </div>
            <div class="form-group">
                <label>Password:</label>
                <input type="password" id="newUserPass" placeholder="password123">
            </div>
            <button class="btn" onclick="createUser()">ğŸ‘¤ Create User</button>
            <div id="userResult"></div>
        </div>

        <!-- CREATE TOOL FORM -->
        <div id="createToolSection" class="section">
            <h2>ğŸ†• Create New Tool</h2>
            <div class="form-group">
                <label>Name:</label>
                <input type="text" id="toolName" placeholder="SQLi Scanner">
            </div>
            <div class="form-group">
                <label>Description:</label>
                <input type="text" id="toolDesc" placeholder="Finds SQL injections">
            </div>
            <div class="form-group">
                <label>URL:</label>
                <input type="url" id="toolUrl" placeholder="https://yourtool.com">
            </div>
            <div class="form-group">
                <label>Price (0=free):</label>
                <input type="number" id="toolPrice" placeholder="0" value="0">
            </div>
            <button class="btn" onclick="createTool()">ğŸ› ï¸ Create Tool</button>
            <div id="toolResult"></div>
        </div>

        <!-- DELETE FORM -->
        <div id="deleteSection" class="section">
            <h2>ğŸ—‘ï¸ Delete Record</h2>
            <div class="form-group">
                <label>Table:</label>
                <select id="deleteTable">
                    <option value="users">Users</option>
                    <option value="tools">Tools</option>
                    <option value="purchases">Purchases</option>
                </select>
            </div>
            <div class="form-group">
                <label>ID:</label>
                <input type="text" id="deleteId" placeholder="user_123 or tool_abc">
            </div>
            <button class="btn danger" onclick="deleteRecord()">ğŸ—‘ï¸ CONFIRM DELETE</button>
            <div id="deleteResult"></div>
        </div>

        <!-- DUMP SECTION -->
        <div id="dumpSection" class="section">
            <h2>ğŸ’¾ Download Full Database</h2>
            <button class="nav-btn" onclick="dumpAllData()">ğŸ“¥ DOWNLOAD JSON DUMP</button>
            <div id="dumpResult"></div>
        </div>
    </div>


<script>
const SUPABASE_URL = 'https://naburjspbrqnymfcmogv.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5hYnVyanNwYnJxbnltZmNtb2d2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA5MDY0NDQsImV4cCI6MjA4NjQ4MjQ0NH0.ABGFW9a0Di9jzRgzwrq5kkEPGfy0YNDznnRFW9HSPm70';
const TABLES = { USERS: 'users', TOOLS: 'tools', PURCHASES: 'purchases', LIKES: 'likes' };

const HEADERS = {
    'apikey': SUPABASE_ANON_KEY,
    'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
    'Content-Type': 'application/json'
};

// Show section
function showSection(sectionId) {
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    document.getElementById(sectionId + 'Section').classList.add('active');
    
    // âœ… RLS-SAFE CALLS ONLY
    if (sectionId === 'stats') loadStatsSafe();
    if (sectionId === 'tools') loadToolsSafe();
    if (sectionId === 'users') loadUsersSafe();
    if (sectionId === 'purchases') loadPurchasesSafe();
}

// âœ… RLS-SAFE API Helper
async function apiRequest(path, options = {}) {
    try {
        const res = await fetch(`${SUPABASE_URL}/rest/v1${path}`, {
            method: options.method || 'GET',
            headers: { ...HEADERS, ...options.headers },
            body: options.body ? JSON.stringify(options.body) : undefined
        });
        const data = await res.json();
        return { data, status: res.status };
    } catch(e) {
        return { data: [], status: 500 };
    }
}

// ğŸ”¥ STATS - Always works
async function loadStatsSafe() {
    const [tools, users, purchases, topTool] = await Promise.all([
        apiRequest('/tools?select=count'),
        apiRequest('/users?select=count'),
        apiRequest('/purchases?select=count'),
        apiRequest('/tools?order=likes_count.desc&limit=1')
    ]);
    
    document.getElementById('toolsCount').textContent = tools.data[0]?.count || 0;
    document.getElementById('usersCount').textContent = users.data[0]?.count || 0;
    document.getElementById('purchasesCount').textContent = purchases.data[0]?.count || 0;
    document.getElementById('topTools').textContent = topTool.data[0]?.likes_count || 0;
}

// ğŸ› ï¸ TOOLS - Simple fields only (no joins)
async function loadToolsSafe() {
    document.getElementById('toolsTable').innerHTML = '<div class="loading">ğŸ”„ Loading safe tools...</div>';
    const { data } = await apiRequest('/tools?order=likes_count.desc&limit=50');
    
    if (!data.length) {
        document.getElementById('toolsTable').innerHTML = '<div class="error">âŒ No tools or RLS blocked</div>';
        return;
    }
    
    let html = `<p>âœ… ${data.length} tools loaded</p>
    <table><tr><th>ID</th><th>Name</th><th>Price</th><th>Likes</th><th>Free?</th></tr>`;
    data.slice(0, 25).forEach(t => {
        html += `<tr>
            <td title="${t.id}">${t.id.slice(-8)}</td>
            <td>${t.name || 'N/A'}</td>
            <td>${t.price || 0}Â¢</td>
            <td>${t.likes_count || 0}â¤ï¸</td>
            <td>${t.is_free ? 'âœ… FREE' : 'âŒ'}</td>
        </tr>`;
    });
    html += '</table>';
    document.getElementById('toolsTable').innerHTML = html;
}

// ğŸ‘¥ USERS - Count + rich users only
async function loadUsersSafe() {
    document.getElementById('usersTable').innerHTML = '<div class="loading">ğŸ”„ Loading users...</div>';
    
    // Total count
    const countRes = await apiRequest('/users?select=count');
    const totalUsers = countRes.data[0]?.count || 0;
    
    // Top 10 richest (RLS usually allows)
    const { data: richUsers } = await apiRequest('/users?order=coins.desc&limit=10');
    
    let html = `<p>ğŸ‘¥ Total: ${totalUsers} users | Showing top ${richUsers.length}</p>
    <table><tr><th>ID</th><th>Username</th><th>Email</th><th>Coins</th><th>Points</th></tr>`;
    
    richUsers.forEach(u => {
        html += `<tr>
            <td title="${u.id}">${u.id.slice(-8)}</td>
            <td>${u.username || 'N/A'}</td>
            <td>${u.email?.slice(0,20) || 'N/A'}</td>
            <td><strong>${u.coins || 0}</strong></td>
            <td>${u.points || 0}</td>
        </tr>`;
    });
    html += '</table>';
    document.getElementById('usersTable').innerHTML = html;
}

// ğŸ›’ PURCHASES - Count + recent
async function loadPurchasesSafe() {
    document.getElementById('purchasesTable').innerHTML = '<div class="loading">ğŸ”„ Loading purchases...</div>';
    
    const countRes = await apiRequest('/purchases?select=count');
    const totalPurchases = countRes.data[0]?.count || 0;
    
    // Recent purchases (simpler query)
    const { data: recent } = await apiRequest('/purchases?order=purchased_at.desc&limit=20');
    
    let html = `<p>ğŸ›’ Total: ${totalPurchases} | Recent ${recent.length}</p>
    <table><tr><th>ID</th><th>User ID</th><th>Tool ID</th><th>Price</th><th>Date</th></tr>`;
    
    recent.forEach(p => {
        html += `<tr>
            <td>${p.id.slice(-12)}...</td>
            <td>${p.user_id?.slice(-8)}</td>
            <td>${p.tool_id?.slice(-8)}</td>
            <td>${p.amount_paid || 0}Â¢</td>
            <td>${p.purchased_at?.slice(0,16)}</td>
        </tr>`;
    });
    html += '</table>';
    document.getElementById('purchasesTable').innerHTML = html;
}

// ğŸ’° ADD COINS (exact web app logic)
async function addCoins() {
    const username = document.getElementById('coinUsername').value.trim();
    const amount = parseInt(document.getElementById('coinAmount').value) || 0;
    
    if (!username) return showResult('coinResult', 'Enter username', 'error');
    
    // Get current coins (exact updateUserCoins)
    const { data: users } = await apiRequest(`/users?username=eq.${username}&select=coins`);
    if (!users.length) return showResult('coinResult', 'âŒ User not found', 'error');
    
    const newCoins = Math.max(0, (users[0].coins || 0) + amount);
    
    // Update (exact web app)
    const { status } = await apiRequest(`/users?username=eq.${username}`, {
        method: 'PATCH'
    }, { coins: newCoins });
    
    const msg = status === 204 ? 
        `âœ… ${username}: ${newCoins} coins (+${amount})` : 
        'âŒ Update failed (RLS?)';
    showResult('coinResult', msg, status === 204 ? 'success' : 'error');
}

// ğŸ†• CREATE USER (exact handleSignup)
async function createUser() {
    const email = document.getElementById('newUserEmail').value.trim();
    const username = document.getElementById('newUserName').value.trim();
    const password = document.getElementById('newUserPass').value;
    
    if (!email || !username || !password) {
        return showResult('userResult', 'Fill all fields', 'error');
    }
    
    const encoder = new TextEncoder();
    const data = encoder.encode(password);
    const hashBuffer = await crypto.subtle.digest('SHA-256', data);
    const hash = Array.from(new Uint8Array(hashBuffer))
        .map(b => b.toString(16).padStart(2, '0')).join('');
    
    const { status } = await apiRequest('/users', { 
        method: 'POST',
        headers: { 'Prefer': 'return=representation' }
    }, { email, username, password_hash: hash, coins: 100, points: 0 });
    
    const msg = status === 201 ? `âœ… ${username} created!` : 'âŒ Create failed';
    showResult('userResult', msg, status === 201 ? 'success' : 'error');
    
    // Clear form
    document.getElementById('newUserEmail').value = '';
    document.getElementById('newUserName').value = '';
    document.getElementById('newUserPass').value = '';
}

// ğŸ†• CREATE TOOL (exact handleUpload)
async function createTool() {
    const name = document.getElementById('toolName').value.trim();
    const desc = document.getElementById('toolDesc').value.trim();
    const url = document.getElementById('toolUrl').value.trim();
    const price = parseInt(document.getElementById('toolPrice').value) || 0;
    
    if (!name || !desc || !url) {
        return showResult('toolResult', 'Fill all fields', 'error');
    }
    
    const id = `tool_${Date.now()}_${Math.random().toString(36).substr(2, 8)}`;
    const tool = {
        id, name, description: desc, tool_url: url,
        price, is_free: price === 0, likes_count: 0,
        created_at: new Date().toISOString()
    };
    
    const { status } = await apiRequest('/tools', { method: 'POST' }, tool);
    
    const msg = status === 201 ? `âœ… "${name}" created!` : 'âŒ Create failed';
    showResult('toolResult', msg, status === 201 ? 'success' : 'error');
    
    // Clear form
    document.getElementById('toolName').value = '';
    document.getElementById('toolDesc').value = '';
    document.getElementById('toolUrl').value = '';
    document.getElementById('toolPrice').value = '0';
}

// ğŸ—‘ï¸ DELETE (safe)
async function deleteRecord() {
    const table = document.getElementById('deleteTable').value;
    const id = document.getElementById('deleteId').value.trim();
    
    if (!id) return showResult('deleteResult', 'Enter ID', 'error');
    
    if (confirm(`âš ï¸ Delete ${table}/${id.slice(0,20)}...?`)) {
        const { status } = await apiRequest(`/${table}?id=eq.${id}`, { 
            method: 'DELETE' 
        });
        const msg = status === 204 ? 'âœ… Deleted successfully' : 'âŒ Delete failed';
        showResult('deleteResult', msg, status === 204 ? 'success' : 'error');
        document.getElementById('deleteId').value = '';
    }
}

// ğŸ’¾ DUMP (safe fields only)
async function dumpAllData() {
    document.getElementById('dumpResult').innerHTML = '<div class="loading">ğŸ”„ Creating safe dump...</div>';
    
    const [toolsCount, usersCount, purchasesCount, toolsSample, usersSample] = await Promise.all([
        apiRequest('/tools?select=count'),
        apiRequest('/users?select=count'),
        apiRequest('/purchases?select=count'),
        apiRequest('/tools?limit=10'),
        apiRequest('/users?order=coins.desc&limit=5')
    ]);
    
    const dump = {
        timestamp: new Date().toISOString(),
        stats: {
            tools: toolsCount.data[0]?.count || 0,
            users: usersCount.data[0]?.count || 0,
            purchases: purchasesCount.data[0]?.count || 0
        },
        sample_tools: toolsSample.data,
        top_users: usersSample.data
    };
    
    const dataStr = JSON.stringify(dump, null, 2);
    const dataBlob = new Blob([dataStr], { type: 'application/json' });
    const url = URL.createObjectURL(dataBlob);
    const link = document.createElement('a');
    link.href = url;
    link.download = `luminux_safe_dump_${new Date().toISOString().slice(0,10)}.json`;
    link.click();
    
    showResult('dumpResult', 'âœ… Safe dump downloaded!', 'success');
}

// RESULT HELPER
function showResult(id, message, type) {
    const el = document.getElementById(id);
    el.innerHTML = `<div class="${type}">${message}</div>`;
    setTimeout(() => el.innerHTML = '', 5000);
}

// INIT
loadStatsSafe();
</script>



        
</body>
</html>
